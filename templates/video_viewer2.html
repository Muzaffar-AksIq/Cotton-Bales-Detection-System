<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video Viewer - Cotton Bale Detection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body {
            background: url('/static/3409297.jpg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
            color: #fff;
        }
        .viewer-header {
            margin-top: 44px;
            font-size: 2.1rem;
            font-weight: 700;
            letter-spacing: 1.3px;
            text-align: center;
            color: #f6faff;
            margin-bottom: 34px;
            text-shadow: 0 8px 40px #00e6ff12;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .camera-section-header {
            font-size: 1.21rem;
            font-weight: 600;
            color: #baf3ff;
            letter-spacing: 1px;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .camera-section {
            margin-bottom: 38px;
        }
        .stream-row {
            display: flex;
            gap: 34px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        .stream-box {
            background: rgba(18, 31, 56, 0.93);
            border-radius: 24px;
            padding: 22px 15px 18px 15px;
            min-width: 240px;
            width: 480px;
            margin-bottom: 0;
            box-shadow: 0 8px 32px 0 rgba(20, 44, 88, 0.18), 0 2px 18px 0 #22e0ff19 inset;
            border: 2px solid rgba(80, 200, 255, 0.09);
            backdrop-filter: blur(16px) saturate(1.14);
            transition: box-shadow 0.25s, border-color 0.25s;
            flex: 1 1 320px;
            max-width: 490px;
        }
        .stream-box:hover {
            border-color: #2df4ffcc;
            box-shadow: 0 14px 55px 0 #28e4ff18, 0 3px 20px 0 #22e0ff21 inset;
        }
        .stream-title {
            font-weight: 700;
            font-size: 1.09rem;
            margin-bottom: 10px;
            text-align: center;
            color: #b3e7ff;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: center;
        }
        .dropdown-row {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 4px;
        }
        .form-select {
            background: rgba(18, 31, 56, 0.45);
            border-radius: 8px;
            color: #9de4ff;
            border: 1.7px solid #15d0ff33;
            font-weight: 600;
            font-size: 1.01rem;
        }
        .form-select:focus {
            border: 1.7px solid #00e7ff;
            outline: none;
            box-shadow: 0 0 5px #00e7ff44;
        }
        .video-placeholder,
        video,
        img {
            width: 100%;
            min-height: 210px;
            background: linear-gradient(120deg, #182245 80%, #222f50 100%);
            border-radius: 13px;
            font-size: 1.08rem;
            color: #79daf6;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 12px #19e0ff17;
            border: 2px solid #2aefff17;
            margin-bottom: 10px;
            object-fit: contain;
        }
        .stats-panel {
            background: rgba(16, 24, 39, 0.97);
            border-radius: 18px;
            margin: 0 auto 0 auto;
            padding: 15px 20px 14px 20px;
            box-shadow: 0 4px 14px #29f3ff14;
            max-width: 480px;
        }
        .stats-panel label {
            color: #9be9ff;
            font-weight: 600;
        }
        .restart-btn {
            margin: 10px 0 12px 0;
            padding: 7px 26px;
            font-size: 1.01rem;
            font-weight: 600;
            border-radius: 7px;
            background: linear-gradient(90deg, #1adbe8 10%, #132544 99%);
            color: #fff;
            border: none;
            box-shadow: 0 2px 8px #1ce2ff08;
            transition: background 0.17s, color 0.17s, transform 0.18s;
        }
        .restart-btn:disabled {
            opacity: 0.65;
            background: #202e38 !important;
            color: #b4e2f3;
            cursor: not-allowed;
        }
        .restart-btn:hover {
            background: linear-gradient(90deg, #17a7fa 20%, #141f2d 90%);
        }
        textarea[readonly] {
            background: #1a283a;
            color: #a9eaff;
            font-size: .98rem;
            border-radius: 6px;
            border: 1.3px solid #22e0ff28;
            box-shadow: 0 1px 6px #22e0ff13;
            padding: 8px;
            width: 100%;
            resize: vertical;
        }
        input[readonly] {
            background: #182437;
            color: #f1fdff;
            font-size: 1.02rem;
            border-radius: 6px;
            border: 1.3px solid #22e0ff18;
            box-shadow: 0 1px 3px #22e0ff09;
            padding: 4px 10px;
            width: 70px;
            text-align: center;
        }
        .logout-btn {
            margin-top: 24px;
            padding: 12px 36px;
            font-size: 1.13rem;
            font-weight: 600;
            border-radius: 11px;
            background: linear-gradient(90deg, #222f50 30%, #2aefff 100%);
            color: #fff;
            border: none;
            box-shadow: 0 2px 12px #1ce2ff13;
            transition: background 0.17s, color 0.17s, transform 0.18s;
        }
        .logout-btn:hover {
            background: linear-gradient(90deg, #21aaff 0%, #182245 95%);
            color: #eaffff;
            transform: scale(1.05);
        }
        .footer {
            margin: 36px auto 10px auto;
            text-align: center;
            font-size: 13.5px;
            color: #b8e6ff;
            opacity: 0.87;
            letter-spacing: .09em;
            user-select: none;
        }
        @media (max-width: 1100px) {
            .stream-row {
                flex-direction: column;
                gap: 20px;
            }
            .stream-box {
                max-width: 100vw;
            }
        }
        @media (max-width: 700px) {
            .viewer-header {
                font-size: 1.15rem;
                margin-top: 20px;
                margin-bottom: 18px;
            }
            .camera-section-header {
                font-size: 1rem;
                margin-bottom: 9px;
            }
            .footer {
                font-size: 11px;
                margin-top: 18px;
            }
            .stream-box, .stats-panel {
                padding: 8px 2vw 8px 2vw;
                width: 97vw;
                min-width: 0;
                max-width: 99vw;
            }
        }
    </style>
    <script>
        function pollStatus(cam) {
            fetch("/check_status?cam=" + cam)
                .then(res => res.json())
                .then(data => {
                    document.getElementById("status_box_" + cam).innerHTML = data.live ?
                        "<div style='color:white;background:green;padding:7px 0;text-align:center;border-radius:8px;font-size:1rem;'>&#128994; LIVE</div>" :
                        "<div style='color:white;background:red;padding:7px 0;text-align:center;border-radius:8px;font-size:1rem;'>&#128308; DISCONNECTED</div>";
                    document.getElementById("restart_btn_" + cam).disabled = data.live;
                });
        }
        function pollStats(cam) {
            fetch("/get_stats?cam=" + cam)
                .then(res => res.json())
                .then(data => {
                    document.getElementById("count_" + cam).value = data.count;
                    document.getElementById("logs_" + cam).value = data.logs;
                });
        }
        setInterval(() => {
            pollStatus(1);
            pollStatus(2);
            pollStats(1);
            pollStats(2);
        }, 2000);

        function toggleStream(id) {
            var dropdown = document.getElementById(id + '-dropdown');
            var area = document.getElementById(id + '-area');
            if (dropdown.value === "show") {
                area.style.display = "";
            } else {
                area.style.display = "none";
            }
        }
    </script>
</head>
<body>
<div class="container" style="max-width:1200px;">

    <div class="viewer-header">
        <i class="bi bi-camera-video-fill" style="font-size:2.1rem; color:#21eaff;"></i>
        Cotton Bale Detection - Dual Camera Viewer
    </div>

    <!-- CAMERA 1 -->
    <div class="camera-section camera1">
        <div class="camera-section-header">
            <i class="bi bi-camera-video"></i> Camera 1
        </div>
        <div class="stream-row">
            <div class="stream-box">
                <div class="stream-title"><i class="bi bi-play-btn"></i>Original Stream</div>
                <div class="dropdown-row">
                    <select class="form-select w-auto" id="original1-dropdown" onchange="toggleStream('original1')">
                        <option value="show" selected>Show</option>
                        <option value="hide">Hide</option>
                    </select>
                </div>
                <div id="original1-area">
                    {% if stream_url1 %}
                    <img src="http://localhost:9000/video" alt="Original Stream 1" />
                    {% else %}
                    <div class="text-danger">No original stream available.</div>
                    {% endif %}
                </div>
            </div>
            <div class="stream-box">
                <div class="stream-title"><i class="bi bi-cpu"></i>Processed Stream</div>
                <div class="dropdown-row">
                    <select class="form-select w-auto" id="processed1-dropdown" onchange="toggleStream('processed1')">
                        <option value="show" selected>Show</option>
                        <option value="hide">Hide</option>
                    </select>
                </div>
                <div id="processed1-area">
                    {% if processed_url %}
                    <img src="http://localhost:9000/processed" alt="Processed Stream 1" />
                    {% else %}
                    <div class="text-danger">No processed stream available.</div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="stats-panel mb-4">
            <div id="status_box_1" class="status-box"></div>
            <button id="restart_btn_1" class="restart-btn" onclick="location.href='/restart_app?cam=1'">
                <i class="bi bi-arrow-repeat"></i> Restart Camera 1
            </button>
            <div class="mt-2">
                <label>Count:</label>
                <input type="text" id="count_1" value="{{ ctr1 }}" readonly>
            </div>
            <div class="mt-2">
                <label>Logs:</label>
                <textarea id="logs_1" rows="5" readonly></textarea>
            </div>
        </div>
    </div>

    <!-- CAMERA 2 -->
    <div class="camera-section camera2">
        <div class="camera-section-header">
            <i class="bi bi-camera-video"></i> Camera 2
        </div>
        <div class="stream-row">
            <div class="stream-box">
                <div class="stream-title"><i class="bi bi-play-btn"></i>Original Stream</div>
                <div class="dropdown-row">
                    <select class="form-select w-auto" id="original2-dropdown" onchange="toggleStream('original2')">
                        <option value="show" selected>Show</option>
                        <option value="hide">Hide</option>
                    </select>
                </div>
                <div id="original2-area">
                    {% if stream_url2 %}
                    <img src="http://localhost:7000/video" alt="Original Stream 2" />
                    {% else %}
                    <div class="text-danger">No original stream available.</div>
                    {% endif %}
                </div>
            </div>
            <div class="stream-box">
                <div class="stream-title"><i class="bi bi-cpu"></i>Processed Stream</div>
                <div class="dropdown-row">
                    <select class="form-select w-auto" id="processed2-dropdown" onchange="toggleStream('processed2')">
                        <option value="show" selected>Show</option>
                        <option value="hide">Hide</option>
                    </select>
                </div>
                <div id="processed2-area">
                    {% if processed_url2 %}
                    <img src="http://localhost:7000/processed" alt="Processed Stream 2" />
                    {% else %}
                    <div class="text-danger">No processed stream available.</div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="stats-panel mb-4">
            <div id="status_box_2" class="status-box"></div>
            <button id="restart_btn_2" class="restart-btn" onclick="location.href='/restart_app?cam=2'">
                <i class="bi bi-arrow-repeat"></i> Restart Camera 2
            </button>
            <div class="mt-2">
                <label>Count:</label>
                <input type="text" id="count_2" value="{{ ctr2 }}" readonly>
            </div>
            <div class="mt-2">
                <label>Logs:</label>
                <textarea id="logs_2" rows="5" readonly></textarea>
            </div>
        </div>
    </div>

    <div class="mt-4 text-center">
        <a href="{{ url_for('logout') }}" class="logout-btn">
            <i class="bi bi-box-arrow-left"></i> Logout
        </a>
    </div>
    <div class="footer">
        © 2025 AKS IQ Private Limited | All Rights Reserved | APP TESTING 0.1
    </div>
</div>
</body>
</html>
